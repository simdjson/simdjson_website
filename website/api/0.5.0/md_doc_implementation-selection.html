<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>simdjson: CPU Architecture-Specific Implementations</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logotiny.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">simdjson
   &#160;<span id="projectnumber">0.5.0</span>
   </div>
   <div id="projectbrief">Ridiculously Fast JSON</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">CPU Architecture-Specific Implementations </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#runtime-cpu-detection">Runtime CPU Detection</a></li>
<li><a href="#inspecting-the-detected-implementation">Inspecting the Detected Implementation</a></li>
<li><a href="#querying-available-implementations">Querying Available Implementations</a></li>
<li><a href="#manually-selecting-the-implementation">Manually Selecting the Implementation</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md37"></a>
Overview</h1>
<p>The simdjson library takes advantage of SIMD instruction sets such as NEON, SSE and AVX to achieve much of its speed. Because these instruction sets work differently, simdjson has to compile a different version of the JSON parser for different CPU architectures, often with different algorithms to take better advantage of a given CPU!</p>
<p>The current implementations are:</p><ul>
<li>haswell: AVX2 (2013 Intel Haswell or later)</li>
<li>westmere: SSE4.2 (2010 Westmere or later).</li>
<li>arm64: 64-bit ARMv8-A NEON</li>
<li>fallback: A generic implementation that runs on any 64-bit processor.</li>
</ul>
<p>In many cases, you don't know where your compiled binary is going to run, so simdjson automatically compiles <em>all</em> the implementations into the executable. On Intel, it will include 3 implementations (haswell, westmere and fallback), and on ARM it will include 2 (arm64 and fallback).</p>
<p>If you know more about where you're going to run and want to save the space, you can disable any of these implementations at compile time with <code>-DSIMDJSON_IMPLEMENTATION_X=0</code> (where X is HASWELL, WESTMERE, ARM64 and FALLBACK).</p>
<p>The simdjson library automatically sets header flags for each implementation as it compiles; there is no need to set architecture-specific flags yourself (e.g., <code>-mavx2</code>, <code>/AVX2</code> or <code>-march=haswell</code>), and it may even break runtime dispatch and your binaries will fail to run on older processors.</p>
<h1><a class="anchor" id="autotoc_md38"></a>
Runtime CPU Detection</h1>
<p>When you first use simdjson, it will detect the CPU you're running on, and swap over to the fastest implementation for it. This is a small, one-time cost and for many people will be paid the first time they call <code>parse()</code> or <code>load()</code>.</p>
<h1><a class="anchor" id="autotoc_md39"></a>
Inspecting the Detected Implementation</h1>
<p>You can check what implementation is running with <code>active_implementation</code>:</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">cout &lt;&lt; &quot;simdjson v&quot; &lt;&lt; STRINGIFY(SIMDJSON_VERSION) &lt;&lt; endl;</div>
<div class="line">cout &lt;&lt; &quot;Detected the best implementation for your machine: &quot; &lt;&lt; simdjson::active_implementation-&gt;name();</div>
<div class="line">cout &lt;&lt; &quot;(&quot; &lt;&lt; simdjson::active_implementation-&gt;description() &lt;&lt; &quot;)&quot; &lt;&lt; endl;</div>
</div><!-- fragment --><p>Implementation detection will happen in this case when you first call <code>name()</code>.</p>
<h1><a class="anchor" id="autotoc_md40"></a>
Querying Available Implementations</h1>
<p>You can list all available implementations, regardless of which one was selected:</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">for (auto implementation : simdjson::available_implementations) {</div>
<div class="line">  cout &lt;&lt; implementation-&gt;name() &lt;&lt; &quot;: &quot; &lt;&lt; implementation-&gt;description() &lt;&lt; endl;</div>
<div class="line">}</div>
</div><!-- fragment --><p>And look them up by name:</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">cout &lt;&lt; simdjson::available_implementations[&quot;fallback&quot;]-&gt;description() &lt;&lt; endl;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md41"></a>
Manually Selecting the Implementation</h1>
<p>If you're trying to do performance tests or see how different implementations of simdjson run, you can select the CPU architecture yourself:</p>
<div class="fragment"><div class="line"> {c++}</div>
<div class="line">// Use the fallback implementation, even though my machine is fast enough for anything</div>
<div class="line">simdjson::active_implementation = simdjson::available_implementations[&quot;fallback&quot;];</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
